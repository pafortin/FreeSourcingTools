javascript:(async()=>{const SLEEP=t=>new Promise(r=>setTimeout(r,t));/* ==== Silencer Sentry + Backoff 429 ==== */const SENTRY_PATTERNS=[/sentry\.io/i,/ingest\./i];(()=>{const of=window.fetch?window.fetch.bind(window):null;if(of){window.fetch=async(...a)=>{try{const u=String((a[0]&&a[0].url)||a[0]||"");if(SENTRY_PATTERNS.some(rx=>rx.test(u)))return new Response(null,{status:204,statusText:"No Content"})}catch{}return of(...a)}}const ob=navigator.sendBeacon?navigator.sendBeacon.bind(navigator):null;if(ob){navigator.sendBeacon=(u,d)=>SENTRY_PATTERNS.some(rx=>rx.test(String(u)))?true:ob(u,d)}const oo=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(m,u){try{if(SENTRY_PATTERNS.some(rx=>rx.test(String(u)))){this.abort();return}}catch{}return oo.apply(this,arguments)}})();async function fetchWithBackoff(input,init,{retries=5,baseDelay=600}={}){let attempt=0;for(;;){const res=await fetch(input,init);if(res.status!==429)return res;attempt++;if(attempt>retries)return res;const retryAfter=parseInt(res.headers.get("Retry-After")||"",10);const delay=Number.isFinite(retryAfter)?retryAfter*1000:baseDelay*Math.pow(2,attempt-1);await SLEEP(delay)}} /* ==== UI: Progress Bar ==== */function makeUI(){const w=document.createElement("div");w.id="meetupPB";w.style.cssText="position:fixed;top:12px;right:12px;z-index:999999;background:#111;color:#fff;padding:12px 14px;border-radius:10px;box-shadow:0 4px 16px rgba(0,0,0,.35);font:14px/1.3 system-ui,sans-serif;min-width:260px";const h=document.createElement("div");h.style="display:flex;align-items:center;gap:10px;margin-bottom:8px";const t=document.createElement("div");t.textContent="Meetup Scraper";t.style="font-weight:600";const c=document.createElement("button");c.textContent="×";c.style="margin-left:auto;background:#222;border:none;color:#aaa;width:26px;height:26px;border-radius:6px;cursor:pointer";c.onclick=()=>w.remove();h.append(t,c);const st=document.createElement("div");st.id="pbStage";st.textContent="Préparation…";st.style="margin:4px 0 8px 0;color:#bbb";const bw=document.createElement("div");bw.style="height:10px;background:#2a2a2a;border-radius:8px;overflow:hidden";const b=document.createElement("div");b.id="pbBar";b.style="height:100%;width:0%;background:linear-gradient(90deg,#6fa8ff,#8e7bff);transition:width .2s";bw.append(b);const sm=document.createElement("div");sm.id="pbSmall";sm.style="margin-top:6px;color:#9aa";w.append(h,st,bw,sm);document.body.appendChild(w)}function setStage(x){const e=document.getElementById("pbStage");if(e)e.textContent=x}function setSmall(x){const e=document.getElementById("pbSmall");if(e)e.textContent=x}function setProgress(p){const e=document.getElementById("pbBar");if(e)e.style.width=Math.min(100,Math.max(0,p))+"%"}/* ==== Scroll pour charger tous les events ==== */async function autoLoadAllPastEvents(max=40){setStage("Chargement des événements…");let h=0,s=0;for(let r=1;r<=max;r++){const btn=[...document.querySelectorAll("button")].find(b=>/show more|voir plus|load more|see more|plus/i.test((b.textContent||"").trim()));if(btn&&!btn.disabled)btn.click();window.scrollTo(0,document.body.scrollHeight);await SLEEP(900);const nh=document.body.scrollHeight;if(nh<=h)s++;else s=0;h=nh;setSmall(%60Scroll ${r}/${max}%60);setProgress(Math.min(30,(r/max)*30));if(s>=3)break}setSmall("Fin du scroll.")}/* ==== Extraction des IDs ==== */function extractEventIds(){const ids=new Set();document.querySelectorAll('a[href*="/events/"]').forEach(a=>{const m=(a.getAttribute("href")||"").match(/\/events\/(\d+)/);if(m)ids.add(m[1])});return[...ids]}/* ==== Appels GraphQL ==== */const GQL="https://www.meetup.com/gql2",OP="getEventByIdForAttendees",HASH="06e14c0b9938b3f0cbd5f0ef3a4cf910d01285c8bcc6ebf76b0f0aafbf19b076",PAGE=100;async function fetchPage(eventId,after){const body={operationName:OP,variables:Object.assign({eventId,filter:{rsvpStatus:["YES","ATTENDED"]},sort:{sortField:"RSVP_ID",sortOrder:"ASC"},first:PAGE},after?{after}:{}),extensions:{persistedQuery:{version:1,sha256Hash:HASH}}};const r=await fetchWithBackoff(GQL,{method:"POST",credentials:"include",headers:{"content-type":"application/json"},body:JSON.stringify(body)});return r.json()}async function fetchAttendees(eventId){const out=[];let after;for(;;){const d=await fetchPage(eventId,after),ev=d?.data?.event;if(!ev)break;(ev.rsvps?.edges||[]).forEach(e=>{const n=e.node||{},m=n.member||{};out.push({eventId,memberName:m.name||"",memberId:m.id||"",status:n.status||"",guests:n.guestsCount??0})});if(!(ev.rsvps?.pageInfo?.hasNextPage))break;after=ev.rsvps.pageInfo.endCursor;await SLEEP(100)}return out}/* ==== Run ==== */async function run(){makeUI();setStage("Init…");setProgress(5);await autoLoadAllPastEvents();const IDS=extractEventIds();if(!IDS.length){setStage("Aucun event trouvé.");setProgress(100);return}setStage(%60${IDS.length} events détectés%60);const start=35,end=95,span=end-start;let done=0;const all=[];for(const id of IDS){done++;setStage(%60Event ${done}/${IDS.length}%60);setSmall(%60id=${id}%60);setProgress(start+Math.round(done/IDS.length*span));const a=await fetchAttendees(id);all.push(...a)}setStage("Export…");setProgress(97);console.table(all);const csv=[Object.keys(all[0]||{}).join(",")].concat(all.map(r=>Object.values(r).map(v=>%60"${String(v).replace(/"/g,'""')}"%60).join(","))).join("\n");const blob=new Blob([csv],{type:"text/csv"});const url=URL.createObjectURL(blob);const a=document.createElement("a");a.href=url;a.download="meetup_attendees.csv";a.click();URL.revokeObjectURL(url);setStage("Terminé");setProgress(100);setSmall(%60${all.length} lignes extraites.%60)}run()})();
